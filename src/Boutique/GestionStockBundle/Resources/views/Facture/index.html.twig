{% extends "BoutiqueGestionStockBundle::layout.html.twig" %}

{% block content %}
    <h3> Liste des factures</h3>

    {% if pagination|length > 0 %}
        {{ pagination|length }} factures :

        <div class="right">{{ pagination.render()|raw }}</div>
        
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="{% if pagination.isSorted('f.id') %}sorted{% endif %}">{{ pagination.sortable('Numéro', 'f.id')|raw }}</th>
                    <th class="{% if pagination.isSorted('f.dateCreation') %}sorted{% endif %}">{{ pagination.sortable('Date création', 'f.dateCreation')|raw }}</th>
                    <th class="{% if pagination.isSorted('f.dateValidation') %}sorted{% endif %}">{{ pagination.sortable('Date finalisation', 'f.dateValidation')|raw }}</th>
                    <th class="{% if pagination.isSorted('articles') %}sorted{% endif %}">{{ pagination.sortable('Articles', 'articles')|raw }}</th>
                    <th class="{% if pagination.isSorted('f.montantFactureTTC') %}sorted{% endif %}">{{ pagination.sortable('Montant', 'f.montantFactureTTC')|raw }}</th>
                    <th>Actions</th>
                </tr>
            <thead>
            <tbody>
                {% for fact in pagination %}
                    {% set facture = fact['facture'] %}
                    {% set count = fact['articles'] %}
                    <tr class="{% if facture.valide %}success{% else %}warning{% endif %}">
                        <td><a href="{% if facture.valide %}{{ path('facture_show', {'id': facture.id}) }}{% else %}{{ path('facture_edit', {'id': facture.id}) }}{% endif %}">facture n°{{ facture.id }}</a></td>
                        <td>{{ facture.dateCreation|date('d/m/Y à  H:i')}}</td>
                        <td>{% if facture.dateValidation %}{{ facture.dateValidation|date('d/m/Y à  H:i')}}{% else %}-{% endif %}</td>
                        <td>{{ count }} articles</td>
                        <td>{{ facture.montantFactureTTC }} €</td>
                        <td class="action_menu">
                            <a href="{{ path('facture_show', { 'id': facture.id }) }}"><div class="btn btn-small" title="Consulter la facture"><span class="icon_16 icon_16_view"></span></div></a>
                            {% if not facture.valide %}
                                <a href="{{ path('facture_edit', { 'id': facture.id }) }}"><div class="btn btn-small" title="Modifier le contenu de cette facture"><span class="icon_16 icon_16_notepad_edit"></span></div></a>
                                <a href="{{ path('facture_delete', { 'id': facture.id }) }}"><div class="btn btn-small" title="Supprimer cette facture non finalisée"><span class="icon_16 icon_16_file_delete"></span></div></a>
                            {% else %}
                                <a href="{{ path('facture_rollback', { 'id': facture.id }) }}"><div class="btn btn-small" title="Annuler la finalisation de cette facture"><span class="icon_16 icon_16_undo"></span></div></a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="right">{{ pagination.render()|raw }}</div>
    {% else %}
        Aucune facture trouvée.
    {% endif %}
{% endblock %}